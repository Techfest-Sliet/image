<html>
	<head>
		<title>
			Image Upload
		</title>
	</head>
	<style>
	h1, label, form {
		width: 100%;
	}
	* {
		text-align: center;
	}
	</style>
	<body>
		<h1>Save an image</h1> <br>
		<form action="/save" method="post" onsubmit="send(event,this)">
			<label for="image">Image</label>
			<input type="file" name="image" id="image"><br><br>
			<input type="submit" value="Submit">
		</form>
		<div class="beholder"></div>
	</body>
	<script>
	let holder = document.getElementsByClassName("beholder")[0];
	const host = "http://" + (new URL(window.location.href)).host;
	function send(e,form) {
		fetch(form.action,{method:'post', body: new FormData(form)}).then( (response) => {
			if (!response.ok) {
				throw new Error(`HTTP error! Status: ${response.status}`);
			}
			return response.json();
		}
		).then( (resp) => {
			console.log(resp);
			let img_div = document.createElement("div");
			img_div.style.textAlign = "center";
			let img = new Image();
			img.src = host + "/get?uuid=" + resp.uuid + "&width=100&height=100";
			img_div.appendChild(img);
			img_div.innerHTML += "<p>uuid: " + resp.uuid + "</p><br>" + "<a href=" + host + "/get?uuid=" + resp.uuid + "&width=100&height=100\">link</a>";
			holder.appendChild(img_div);

		} );
		console.log('We send post asynchronously (AJAX)');
		e.preventDefault();
	}
	</script>
</html>
